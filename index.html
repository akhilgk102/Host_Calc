<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profit Distribution</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&family=DM+Mono:wght@300;400&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        :root {
            --bg: #0a0a0c;
            --surface: #111116;
            --surface2: #16161d;
            --border: rgba(255,255,255,0.06);
            --gold: #c9a84c;
            --gold-light: #e8c97a;
            --gold-dim: rgba(201,168,76,0.15);
            --text: #ffffff;
            --muted: rgba(255,255,255,0.65);
            --green: #4caf7d;
            --green-dim: rgba(76,175,125,0.12);
        }

        body {
            font-family: 'DM Mono', monospace;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background:
                radial-gradient(ellipse 60% 40% at 20% 20%, rgba(201,168,76,0.06) 0%, transparent 60%),
                radial-gradient(ellipse 50% 60% at 80% 80%, rgba(76,175,125,0.04) 0%, transparent 60%);
            pointer-events: none;
            z-index: 0;
        }

        body::after {
            content: '';
            position: fixed;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.035'/%3E%3C/svg%3E");
            background-size: 180px 180px;
            pointer-events: none;
            z-index: 0;
        }

        .orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(80px);
            pointer-events: none;
            z-index: 0;
            animation: drift 12s ease-in-out infinite alternate;
        }
        .orb-1 { width: 320px; height: 320px; background: rgba(201,168,76,0.07); top: -80px; left: -60px; }
        .orb-2 { width: 280px; height: 280px; background: rgba(76,175,125,0.05); bottom: -60px; right: -40px; animation-delay: -6s; }

        @keyframes drift {
            from { transform: translate(0,0) scale(1); }
            to { transform: translate(30px, 20px) scale(1.1); }
        }

        /* CARD */
        .card {
            position: relative;
            z-index: 1;
            width: 1100px;
            border-radius: 20px;
            border: 1px solid var(--border);
            overflow: hidden;
            box-shadow:
                0 0 0 1px rgba(201,168,76,0.05),
                0 40px 80px rgba(0,0,0,0.6),
                0 2px 4px rgba(0,0,0,0.4);
            animation: rise 0.8s cubic-bezier(0.16, 1, 0.3, 1) both;
            display: flex;
            flex-direction: column;
        }

        @keyframes rise {
            from { opacity: 0; transform: translateY(30px) scale(0.97); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .card-top-bar {
            height: 2px;
            flex-shrink: 0;
            background: linear-gradient(90deg, transparent 0%, var(--gold) 40%, var(--gold-light) 60%, transparent 100%);
            opacity: 0.7;
        }

        /* HEADER */
        .card-header {
            padding: 28px 44px 22px;
            border-bottom: 1px solid var(--border);
            background: var(--surface);
            flex-shrink: 0;
        }

        .eyebrow {
            font-size: 11px;
            letter-spacing: 0.3em;
            text-transform: uppercase;
            color: var(--gold);
            opacity: 0.8;
            margin-bottom: 8px;
        }

        h1 {
            font-family: 'Cormorant Garamond', serif;
            font-weight: 300;
            font-size: 42px;
            letter-spacing: 0.02em;
            line-height: 1.1;
        }
        h1 span { color: var(--gold); }

        /* TWO-COLUMN BODY */
        .card-body {
            display: grid;
            grid-template-columns: 1fr 1px 1fr;
        }

        .pane-left {
            padding: 30px 36px 38px;
            background: var(--surface);
        }

        .v-divider {
            background: var(--border);
        }

        .pane-right {
            padding: 30px 36px 38px;
            background: var(--surface2);
            display: flex;
            flex-direction: column;
        }

        /* FORM */
        .field { margin-bottom: 16px; }

        label {
            display: block;
            font-size: 10px;
            letter-spacing: 0.25em;
            text-transform: uppercase;
            color: var(--muted);
            margin-bottom: 8px;
        }

        .input-wrap { position: relative; }

        .input-prefix {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gold);
            font-size: 16px;
            opacity: 0.7;
            pointer-events: none;
        }

        input[type="number"] {
            width: 100%;
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 14px 14px 14px 40px;
            color: var(--text);
            font-family: 'DM Mono', monospace;
            font-size: 16px;
            font-weight: 300;
            outline: none;
            transition: border-color 0.25s, box-shadow 0.25s, background 0.25s;
            appearance: textfield;
            -moz-appearance: textfield;
            -webkit-text-size-adjust: 100%;
        }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; }
        input[type="number"]::placeholder { color: rgba(255,255,255,0.25); }
        input[type="number"]:focus {
            border-color: rgba(201,168,76,0.4);
            background: #1a1a22;
            box-shadow: 0 0 0 3px rgba(201,168,76,0.07), inset 0 1px 3px rgba(0,0,0,0.3);
        }
        input[type="number"]:hover:not(:focus) { border-color: rgba(255,255,255,0.1); }

        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
        }

        /* ── PARTNER SELECTOR ── */
        .partner-selector {
            display: flex;
            gap: 8px;
            width: 100%;
        }

        .partner-btn {
            flex: 1;
            padding: 13px 4px;
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: rgba(255,255,255,0.45);
            font-family: 'DM Mono', monospace;
            font-size: 17px;
            font-weight: 400;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            -webkit-tap-highlight-color: transparent;
            margin-top: 0;
            box-shadow: none;
            letter-spacing: 0;
            text-transform: none;
        }
        .partner-btn:hover:not(.active) {
            border-color: rgba(201,168,76,0.25);
            color: rgba(255,255,255,0.75);
            transform: translateY(-1px);
            background: #1a1a22;
        }
        .partner-btn.active {
            background: linear-gradient(135deg, #b8922e 0%, #c9a84c 40%, #e8c97a 70%, #c9a84c 100%);
            border-color: transparent;
            color: #0a0805;
            font-weight: 400;
            box-shadow: 0 4px 16px rgba(201,168,76,0.3), 0 1px 3px rgba(0,0,0,0.4);
            transform: translateY(-1px);
        }
        .partner-btn:active { transform: translateY(0) scale(0.97); }

        button {
            width: 100%;
            margin-top: 14px;
            padding: 15px;
            background: linear-gradient(135deg, #b8922e 0%, #c9a84c 40%, #e8c97a 70%, #c9a84c 100%);
            background-size: 200% 200%;
            border: none;
            border-radius: 10px;
            color: #0a0805;
            font-family: 'DM Mono', monospace;
            font-size: 12px;
            font-weight: 400;
            letter-spacing: 0.25em;
            text-transform: uppercase;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s, background-position 0.4s;
            box-shadow: 0 4px 20px rgba(201,168,76,0.25), 0 1px 3px rgba(0,0,0,0.4);
            -webkit-tap-highlight-color: transparent;
        }
        button::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, rgba(255,255,255,0.12) 0%, transparent 60%);
            pointer-events: none;
        }
        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 30px rgba(201,168,76,0.35), 0 2px 6px rgba(0,0,0,0.5);
            background-position: right center;
        }
        button:active { transform: translateY(0) scale(0.99); }

        /* RIGHT PANE */
        .pane-right-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }
        .divider-line { flex: 1; height: 1px; background: var(--border); }
        .pane-right-title {
            font-size: 10px;
            letter-spacing: 0.3em;
            text-transform: uppercase;
            color: var(--muted);
            white-space: nowrap;
        }

        /* Empty state */
        .empty-state {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 14px;
            opacity: 0.28;
            user-select: none;
        }
        .empty-icon {
            width: 54px;
            height: 54px;
            border: 1.5px solid var(--border);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Cormorant Garamond', serif;
            font-size: 26px;
            color: var(--gold);
        }
        .empty-text {
            font-size: 11px;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--muted);
            text-align: center;
            line-height: 2;
        }

        /* Result cards */
        .results-panel {
            flex: 1;
            opacity: 0;
            transform: translateX(14px);
            transition: opacity 0.5s ease, transform 0.5s ease;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            gap: 11px;
        }
        .results-panel.visible {
            opacity: 1;
            transform: translateX(0);
            pointer-events: auto;
        }

        .result-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 18px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: border-color 0.3s;
            animation: slide-in 0.4s ease both;
        }
        .result-card:nth-child(1) { animation-delay: 0.05s; }
        .result-card:nth-child(2) { animation-delay: 0.13s; }
        .result-card:nth-child(3) { animation-delay: 0.21s; }

        @keyframes slide-in {
            from { opacity: 0; transform: translateX(10px); }
            to   { opacity: 1; transform: translateX(0); }
        }

        .result-card:hover { border-color: rgba(255,255,255,0.1); }
        .result-card.highlight {
            background: var(--gold-dim);
            border-color: rgba(201,168,76,0.22);
        }
        .result-card.highlight:hover { border-color: rgba(201,168,76,0.38); }

        .result-label {
            font-size: 10px;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: rgba(255,255,255,0.7);
            margin-bottom: 5px;
        }
        .result-value {
            font-family: 'Cormorant Garamond', serif;
            font-size: 28px;
            font-weight: 600;
            color: var(--text);
            letter-spacing: 0.01em;
        }
        .result-card.highlight .result-value { color: var(--gold-light); }

        .result-badge {
            font-size: 10px;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            padding: 5px 12px;
            border-radius: 20px;
            border: 1px solid;
            white-space: nowrap;
        }
        .badge-working {
            color: var(--gold);
            border-color: rgba(201,168,76,0.3);
            background: rgba(201,168,76,0.08);
        }
        .badge-passive {
            color: var(--green);
            border-color: rgba(76,175,125,0.3);
            background: var(--green-dim);
        }

        .error-msg {
            background: rgba(255,80,80,0.08);
            border: 1px solid rgba(255,80,80,0.2);
            border-radius: 10px;
            padding: 14px 18px;
            font-size: 12px;
            color: rgba(255,120,120,0.9);
            letter-spacing: 0.05em;
        }

        /* ── LIVE VIEWERS WIDGET ── */
        .live-viewers {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 14px 6px 10px;
            background: rgba(76,175,125,0.08);
            border: 1px solid rgba(76,175,125,0.18);
            border-radius: 20px;
            cursor: default;
            user-select: none;
            transition: border-color 0.3s, background 0.3s;
        }
        .live-viewers:hover {
            background: rgba(76,175,125,0.13);
            border-color: rgba(76,175,125,0.3);
        }

        .live-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background: var(--green);
            flex-shrink: 0;
            position: relative;
        }
        .live-dot::before {
            content: '';
            position: absolute;
            inset: -3px;
            border-radius: 50%;
            background: var(--green);
            opacity: 0.3;
            animation: pulse-ring 2s ease-out infinite;
        }
        @keyframes pulse-ring {
            0%   { transform: scale(0.8); opacity: 0.4; }
            70%  { transform: scale(1.8); opacity: 0; }
            100% { transform: scale(0.8); opacity: 0; }
        }

        .live-label {
            font-size: 10px;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--green);
        }

        .live-count {
            font-size: 13px;
            font-weight: 400;
            color: #ffffff;
            letter-spacing: 0.05em;
            min-width: 16px;
            text-align: center;
            transition: opacity 0.3s;
        }

        .live-count.updating {
            opacity: 0.4;
        }

        /* Loading shimmer for count */
        @keyframes shimmer {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.8; }
        }
        .live-count.loading {
            animation: shimmer 1s ease-in-out infinite;
        }

        /* ── RESPONSIVE ── */
        @media (max-width: 1140px) {
            .card { width: calc(100vw - 32px); max-width: 1100px; }
        }

        @media (max-width: 700px) {
            body {
                align-items: flex-start;
                padding: 16px;
                overflow-y: auto;
                overflow-x: hidden;
            }
            .card {
                width: 100%;
                border-radius: 16px;
            }
            .card-header { padding: 24px 22px 20px; }
            h1 { font-size: 32px; }
            .eyebrow { font-size: 10px; }

            .card-body {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1px auto;
            }
            .v-divider { height: 1px; width: 100%; }

            .pane-left { padding: 24px 22px 28px; }
            .pane-right { padding: 24px 22px 32px; }

            .two-col { grid-template-columns: 1fr 1fr; gap: 10px; }

            input[type="number"] {
                font-size: 16px;
                padding: 13px 12px 13px 36px;
            }
            .input-prefix { font-size: 17px; }
            button { padding: 14px; font-size: 11px; margin-top: 16px; }

            .result-value { font-size: 26px; }
            .result-card { padding: 16px 16px; border-radius: 12px; }
            .result-badge { font-size: 9px; padding: 4px 9px; }

            .pane-right-header { margin-bottom: 18px; }
            .empty-icon { width: 46px; height: 46px; font-size: 22px; }
            .empty-text { font-size: 10px; }
            .orb-1 { width: 200px; height: 200px; }
            .orb-2 { width: 160px; height: 160px; }

            .company-bar {
                padding: 12px 22px;
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            .company-right { text-align: left; }
            .company-name { font-size: 17px; }
        }

        @media (max-width: 380px) {
            h1 { font-size: 26px; }
            .two-col { grid-template-columns: 1fr; }
            .result-value { font-size: 22px; }
        }

        /* ── COMPANY DETAILS ── */
        .company-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 44px;
            background: rgba(201,168,76,0.06);
            border-bottom: 1px solid rgba(201,168,76,0.12);
            flex-shrink: 0;
        }

        .company-left {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .company-logo {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Cormorant Garamond', serif;
            font-size: 20px;
            font-weight: 600;
            color: #0a0805;
            flex-shrink: 0;
        }

        .company-name {
            font-family: 'Cormorant Garamond', serif;
            font-size: 25px;
            font-weight: 600;
            color: #ffffff;
            letter-spacing: 0.04em;
            line-height: 1.1;
        }

        .company-tagline {
            font-size: 12px;
            letter-spacing: 0.25em;
            text-transform: uppercase;
            color: var(--gold);
            opacity: 0.85;
            margin-top: 2px;
        }

        .company-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .company-meta {
            font-size: 12px;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: rgba(255,255,255,0.4);
            text-align: right;
            line-height: 1.9;
        }

        /* Amount preview */
        .amount-preview {
            margin-top: 6px;
            font-family: 'Cormorant Garamond', serif;
            font-size: 17px;
            font-weight: 400;
            color: var(--gold-light);
            letter-spacing: 0.02em;
            min-height: 22px;
            transition: opacity 0.2s;
        }

        /* Result sub-detail */
        .result-sub {
            font-size: 11px;
            color: rgba(255,255,255,0.5);
            margin-top: 4px;
            letter-spacing: 0.05em;
        }
        .result-card.highlight .result-sub { color: rgba(232,200,100,0.65); }

        /* Viewers tooltip */
        .live-viewers-wrap {
            position: relative;
        }
        .live-tooltip {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: #1e1e28;
            border: 1px solid rgba(76,175,125,0.2);
            border-radius: 10px;
            padding: 10px 14px;
            font-size: 11px;
            color: rgba(255,255,255,0.6);
            letter-spacing: 0.08em;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transform: translateY(-4px);
            transition: opacity 0.2s, transform 0.2s;
            z-index: 10;
            box-shadow: 0 8px 24px rgba(0,0,0,0.5);
        }
        .live-viewers-wrap:hover .live-tooltip {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body>

<div class="orb orb-1"></div>
<div class="orb orb-2"></div>

<div class="card">
    <div class="card-top-bar"></div>

    <div class="company-bar">
        <div class="company-left">
            <div class="company-logo">H</div>
            <div>
                <div class="company-name">Hostlane Technolab</div>
                <div class="company-tagline">Software that cares</div>
            </div>
        </div>
        <div class="company-right">
            <div class="company-meta">
                Internal Financial Tool<br>
                Profit Distribution v2.0
            </div>
            <!-- LIVE VIEWERS WIDGET -->
            <div class="live-viewers-wrap">
                <div class="live-viewers" id="live-viewers-btn">
                    <div class="live-dot"></div>
                    <span class="live-label">Live</span>
                    <span class="live-count loading" id="live-count">—</span>
                </div>
                <div class="live-tooltip" id="live-tooltip">Refreshes every 15 seconds</div>
            </div>
        </div>
    </div>

    <div class="card-header">
        <div class="eyebrow">Financial Tool</div>
        <h1>Profit <span>Distribution</span></h1>
    </div>

    <div class="card-body">

        <!-- LEFT — Inputs -->
        <div class="pane-left">
            <div class="field">
                <label>Total Amount</label>
                <div class="input-wrap">
                    <span class="input-prefix">₹</span>
                    <input type="number" id="amount" placeholder="0.00" oninput="onAmountInput()">
                </div>
                <div id="amount-preview" class="amount-preview"></div>
            </div>

            <div class="two-col">
                <div class="field">
                    <label>Extra Percentage</label>
                    <div class="input-wrap">
                        <span class="input-prefix">%</span>
                        <input type="number" id="percentage" placeholder="0" oninput="autoCalc()">
                    </div>
                </div>
                <div class="field">
                    <label>Working Partners</label>
                    <div class="partner-selector" id="partner-selector">
                        <button type="button" class="partner-btn" onclick="selectPartner(1)">1</button>
                        <button type="button" class="partner-btn" onclick="selectPartner(2)">2</button>
                        <button type="button" class="partner-btn" onclick="selectPartner(3)">3</button>
                        <button type="button" class="partner-btn" onclick="selectPartner(4)">4</button>
                        <button type="button" class="partner-btn" onclick="selectPartner(5)">5</button>
                    </div>
                </div>
            </div>

            <button onclick="calculate()">Calculate Distribution</button>
        </div>

        <!-- Vertical separator -->
        <div class="v-divider"></div>

        <!-- RIGHT — Results -->
        <div class="pane-right">
            <div class="pane-right-header">
                <div class="pane-right-title">Breakdown</div>
                <div class="divider-line"></div>
            </div>

            <div class="empty-state" id="empty-state">
                <div class="empty-icon">₹</div>
                <div class="empty-text">Enter values on the left<br>to see the breakdown</div>
            </div>

            <div class="results-panel" id="results"></div>
        </div>

    </div>
</div>

<script>
/* ═══════════════════════════════════════
   LIVE VIEWERS — persistent shared storage
   Each session writes a heartbeat key every 15s.
   Count = sessions with heartbeat < 30s old.
   ═══════════════════════════════════════ */

const SESSION_ID   = 'sess_' + Math.random().toString(36).slice(2, 10);
const HEARTBEAT_MS = 15_000;   // write heartbeat every 15s
const STALE_MS     = 35_000;   // session considered gone after 35s

async function writeHeartbeat() {
    try {
        await window.storage.set(
            'viewers:' + SESSION_ID,
            String(Date.now()),
            true   // shared = visible to all
        );
    } catch (_) {}
}

async function countLiveViewers() {
    try {
        const listResult = await window.storage.list('viewers:', true);
        if (!listResult) return 1;
        const keys = listResult.keys || [];
        const now  = Date.now();
        let   live = 0;

        await Promise.all(keys.map(async key => {
            try {
                const r = await window.storage.get(key, true);
                if (r && r.value) {
                    const ts = parseInt(r.value, 10);
                    if (!isNaN(ts) && (now - ts) < STALE_MS) live++;
                }
            } catch (_) {}
        }));

        return Math.max(live, 1); // always at least 1 (you)
    } catch (_) {
        return 1;
    }
}

async function refreshViewers() {
    const el = document.getElementById('live-count');
    el.classList.add('updating');

    await writeHeartbeat();
    const count = await countLiveViewers();

    el.classList.remove('loading', 'updating');
    el.textContent = count;
}

// Kick off immediately, then on interval
refreshViewers();
setInterval(refreshViewers, HEARTBEAT_MS);

// Clean up own heartbeat on page leave
window.addEventListener('beforeunload', async () => {
    try { await window.storage.delete('viewers:' + SESSION_ID, true); } catch (_) {}
});


/* ═══════════════════════════════════════
   PROFIT DISTRIBUTION LOGIC
   ═══════════════════════════════════════ */

let selectedWorking = null;

function selectPartner(n) {
    selectedWorking = n;
    document.querySelectorAll('.partner-btn').forEach((btn, i) => {
        btn.classList.toggle('active', i + 1 === n);
    });
    autoCalc();
}

function fmtIndian(n) {
    if (isNaN(n) || n === null) return '';
    return '\u20B9\u202f' + n.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}

function shortFmt(n) {
    return '\u20B9 ' + n.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}

function onAmountInput() {
    const val = parseFloat(document.getElementById('amount').value);
    const preview = document.getElementById('amount-preview');
    preview.textContent = (val && !isNaN(val))
        ? val.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })
        : '';
    autoCalc();
}

let autoCalcTimer = null;
function autoCalc() {
    clearTimeout(autoCalcTimer);
    autoCalcTimer = setTimeout(() => {
        const total   = parseFloat(document.getElementById('amount').value);
        const percent = parseFloat(document.getElementById('percentage').value);
        if (total && !isNaN(percent) && selectedWorking) {
            renderResults(total, percent, selectedWorking);
        }
    }, 300);
}

function calculate() {
    const total   = parseFloat(document.getElementById('amount').value);
    const percent = parseFloat(document.getElementById('percentage').value);
    const resultsEl = document.getElementById('results');
    const emptyEl   = document.getElementById('empty-state');

    if (!total || isNaN(percent) || !selectedWorking) {
        emptyEl.style.display = 'none';
        resultsEl.innerHTML = `<div class="error-msg">Please fill in all fields and select working partners to continue.</div>`;
        resultsEl.classList.add('visible');
        return;
    }
    renderResults(total, percent, selectedWorking);
}

function renderResults(total, percent, working) {
    const resultsEl = document.getElementById('results');
    const emptyEl   = document.getElementById('empty-state');

    resultsEl.classList.remove('visible');

    setTimeout(() => {
        emptyEl.style.display = 'none';

        const totalMembers    = 5;
        const extraAmount     = (percent / 100) * total;
        const remaining       = total - extraAmount;
        const equalShare      = remaining / totalMembers;
        const extraPerWorking = extraAmount / working;
        const workingFinal    = equalShare + extraPerWorking;

        resultsEl.innerHTML = `
            <div class="result-card highlight">
                <div>
                    <div class="result-label">Working Partner Total</div>
                    <div class="result-value">${fmtIndian(workingFinal)}</div>
                    <div class="result-sub">Base ${shortFmt(equalShare)} + Bonus ${shortFmt(extraPerWorking)}</div>
                </div>
                <div class="result-badge badge-working">Working</div>
            </div>
            <div class="result-card">
                <div>
                    <div class="result-label">Non-Working Partner</div>
                    <div class="result-value">${fmtIndian(equalShare)}</div>
                    <div class="result-sub">Equal base share only</div>
                </div>
                <div class="result-badge badge-passive">Passive</div>
            </div>
            <div class="result-card">
                <div>
                    <div class="result-label">Extra Pool (${percent}%)</div>
                    <div class="result-value">${fmtIndian(extraAmount)}</div>
                    <div class="result-sub">${shortFmt(extraPerWorking)} per working partner</div>
                </div>
                <div class="result-badge badge-passive">Bonus Pool</div>
            </div>
            <div class="result-card">
                <div>
                    <div class="result-label">Base Pool (Remaining)</div>
                    <div class="result-value">${fmtIndian(remaining)}</div>
                    <div class="result-sub">${shortFmt(equalShare)} × ${totalMembers} members</div>
                </div>
                <div class="result-badge badge-passive">Base</div>
            </div>
        `;

        resultsEl.classList.add('visible');
    }, 120);
}

document.addEventListener('keydown', e => { if (e.key === 'Enter') calculate(); });
</script>
</body>
</html>